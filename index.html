<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://docs.xmlui.org/resources/files/for-download/xmlui/xmlui-standalone.umd.js"></script>
    <script src="xmlui/xmlui-hello-auth.js"></script>
    <script>
      window.config = {};
      fetch("config.json")
        .then((r) => (r.ok ? r.json() : {}))
        .then((c) => Object.assign(window.config, c));
    </script>
    <script>
      // Decode HTML entities (e.g. convert '&lt;' -> '<')
      window.decodeHtml = function (s) {
        if (s == null) return "";
        const doc = new DOMParser().parseFromString(String(s), "text/html");
        return doc.documentElement.textContent || "";
      };

      // Obtain header with optional decoding (decode default true)
      window.getHeader = function (message, headerName, decode = true) {
        const header = message?.payload?.headers?.find(
          (h) => h.name.toLowerCase() === headerName.toLowerCase()
        );
        if (!header) return "";
        return decode ? window.decodeHtml(header.value) : header.value;
      };

      // Extracts name from "Name <email>" or returns the whole string if no email
      window.extractName = function (str) {
        if (!str) return "";
        const match = str.match(/^(.+?)\s*</);
        return match ? match[1].trim().replace(/^["']|["']$/g, "") : str;
      };

      // Extracts email from "Name <email>"
      window.extractEmail = function (str) {
        const match = str?.match(/<([^>]+)>/);
        return match ? match[1] : "";
      };

      // Escape HTML special characters to render raw text safely
      window.escapeHtml = function (s) {
        return String(s || "")
          .replace(/&/g, "&amp;")
          .replace(/</g, "&lt;")
          .replace(/>/g, "&gt;")
          .replace(/"/g, "&quot;")
          .replace(/'/g, "&#39;");
      };
    </script>
  </head>

  <body></body>
</html>
